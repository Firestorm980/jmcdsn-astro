---
import Archive from '../../layouts/Archive.astro';
import Single from '../../layouts/Single.astro';

export async function getStaticPaths({ paginate }) {
	// Load your data with fetch(), Astro.fetchContent(), etc.
	let posts = await Astro.fetchContent('./**/*.md');

	// Sort posts in reverse chronological order (newest first).
	posts.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());

	// Remap URLs for posts and add params.
	const postParams = posts.map(post => {
		const { url } = post;
		const [postsFolder, yearFolder, folderSlug, fileName] = url.split('/').filter(item => item !== '');

		return {
			params: {
				page: folderSlug,
			},
			props: {
				...post
			}
		};
	});

	// Create pagination.
	const paginationParams = paginate(posts);

	// Return the combined params.
	return [
		...postParams,
		...paginationParams
	];
};

const {page} = Astro.props;
---
{page
	? <Archive page={page} />
	: <Single {...Astro.props} />
}
