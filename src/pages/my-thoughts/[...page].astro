---
import Archive from '../../layouts/Archive.astro';
import Single from '../../layouts/Single.astro';
import { setPostLink } from './../../utils';

export async function getStaticPaths({ paginate }) {
	// Load your data with fetch(), Astro.fetchContent(), etc.
	let posts = await Astro.fetchContent('./../../posts/**/*.md');

	// Sort posts in reverse chronological order (newest first).
	posts.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());

	// Remap URLs for posts and add params.
	const postParams = posts.map(post => {
		const href = setPostLink(post);

		return {
			params: {
				page: href,
			},
			props: {
				...post
			}
		};
	});

	// Create pagination.
	const paginationParams = paginate(posts);

	// Return the combined params.
	return [
		...postParams,
		...paginationParams
	];
};

const {page} = Astro.props;
---
{page
	? <Archive page={page} />
	: <Single {...Astro.props} />
}
