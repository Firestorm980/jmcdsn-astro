---
import Archive from '../../layouts/Archive.astro';
import Single from '../../layouts/Single.astro';
import { setPostLink } from './../../utils';

export async function getStaticPaths({ paginate }) {
	// Load your data with fetch(), Astro.fetchContent(), etc.
	let posts = await Astro.fetchContent('./../../posts/**/*.md');

	// Sort posts in reverse chronological order (newest first).
	posts.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());

	// Remap URLs for posts and add params.
	const postParams = posts.map(post => {
		const href = setPostLink(post);

		return {
			params: {
				page: href,
			},
			props: {
				kind: 'single',
				...post
			}
		};
	});

	// Create pagination.
	let paginationParams = paginate(posts);
	paginationParams = paginationParams.map((params) => ({ ...params, kind: 'archive' }))

	// Return the combined params.
	return [
		...postParams,
		...paginationParams
	];
};

const { kind } = Astro.props;
---
{'single' === kind
	? <Single {...Astro.props} />
	: <Archive {...Astro.props} />
}
