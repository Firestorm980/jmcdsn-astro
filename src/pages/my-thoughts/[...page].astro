---
import Archive from '@layouts/Archive.astro';
import Single from '@layouts/Single.astro';
import { setPostLink } from './../../utils';

export async function getStaticPaths({ paginate }) {
	// Load your data with fetch(), Astro.glob(), etc.
	let posts = await Astro.glob('./../../posts/**/*.md');

	// Sort posts in reverse chronological order (newest first).
	posts.sort((a, b) => new Date(b.frontmatter.date).getTime() - new Date(a.frontmatter.date).getTime());

	// Remap URLs for posts and add params.
	const postParams = posts.map(post => {
		const href = setPostLink(post);

		return {
			params: {
				page: href,
			},
			props: {
				kind: 'single single-post',
				post: {...post}
			}
		};
	});

	// Create pagination.
	let paginationParams = paginate(posts);
	paginationParams = paginationParams.map((params) => {
		return {
			...params,
			props: {
				...params.props,
				kind: 'archive'
			}
		}
	});

	// Return the combined params.
	return [
		...postParams,
		...paginationParams
	];
};

const { kind, page, post } = Astro.props;
---
{'archive' !== kind
	? <Single kind={kind} post={post} />
	: <Archive kind={kind} page={page} />
}
