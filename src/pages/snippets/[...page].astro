---
import ArchiveSnippet from '@layouts/ArchiveSnippet.astro';
import Single from '@layouts/Single.astro';
import { setSnippetLink } from './../../utils'

export async function getStaticPaths() {
	// Load your data with fetch(), Astro.glob(), etc.
	let snippets = await Astro.glob('./../../snippets/**/*.md');

	// Remap URLs for snippets and add params.
	const snippetParams = snippets.map(snippet => {
		const href = setSnippetLink(snippet);

		return {
			params: {
				page: href,
			},
			props: {
				kind: 'single single-snippet',
				post: {...snippet}
			}
		};
	});

	return [
		// Archive
		{
			params: {},
			props: {
				kind: 'archive',
				snippets
			}
		},
		// Individual
		...snippetParams,
	];
}

const { kind, snippets, post } = Astro.props;
---
{
	'archive' !== kind
	? <Single kind={kind} post={post} />
	: <ArchiveSnippet kind={kind} snippets={snippets} />
}
