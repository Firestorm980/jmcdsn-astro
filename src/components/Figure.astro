---
import { Image } from 'astro:assets';

interface Props {
    src: string;
    alt: string;
    caption?: string;
    width: number;
    height: number;
}

const { caption, src, alt, width, height } = Astro.props;

// The following code is a recipe for dynamically importing images in Astro.
// https://docs.astro.build/en/recipes/dynamically-importing-images/#recipe
const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/images/posts/*.{jpeg,jpg,png,gif,webp}');

// Ensure the image exists. Error if it doesn't.
if (!images[src]) throw new Error(`"${src}" does not exist in glob: "/src/assets/images/posts/*.{jpeg,jpg,png,gif,webp}"`);

const image = images[src]();
const imageWidths = [480,640,960,1280,1920,2560,3840];
---
<figure>
    <Image src={image} alt={alt} width={width} height={height} widths={imageWidths} />
    {caption && (<figcaption>{caption}</figcaption>)}
</figure>
